<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control · REMAEP 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Montserrat', sans-serif; background: #000b1a; color: white; }
        .editable-field:focus { outline: 2px solid #00e5ff; background: rgba(0,229,255,0.1); border-radius: 4px; }
        
        /* Estilos del área de carga */
        .upload-zone { transition: all 0.3s ease; }
        .upload-zone:hover { border-color: #00e5ff; background: rgba(0,229,255,0.05); }
        
        .toast {
            position: fixed; bottom: 20px; right: 20px;
            background: rgba(0,229,255,0.9); color: #000;
            padding: 12px 24px; border-radius: 8px; font-weight: bold;
            transform: translateY(100px); transition: transform 0.3s;
        }
        .toast.show { transform: translateY(0); }
    </style>
</head>
<body class="bg-slate-900 h-screen flex overflow-hidden">

    <aside class="w-64 bg-slate-950 border-r border-slate-800 p-6 hidden md:block">
        <div class="flex items-center gap-3 mb-10">
            <i data-lucide="shield" class="text-cyan-400"></i>
            <span class="font-bold text-lg">REMAEP ADMIN</span>
        </div>
        <nav class="space-y-4 text-sm text-slate-400">
            <a href="#" class="block text-cyan-400 font-bold">Dashboard</a>
            <a href="index.html" class="block hover:text-white">Ver Sitio Público</a>
        </nav>
    </aside>

    <main class="flex-1 overflow-y-auto p-8 relative">
        
        <header class="flex justify-between items-center mb-10">
            <h1 class="text-3xl font-bold">Configuración SaaS</h1>
            <button onclick="guardarCambios()" class="bg-cyan-500 hover:bg-cyan-400 text-slate-900 font-bold px-6 py-2 rounded-lg flex items-center gap-2 transition-all shadow-[0_0_20px_rgba(0,229,255,0.3)]">
                <i data-lucide="save" class="w-4 h-4"></i> GUARDAR CAMBIOS
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i data-lucide="dollar-sign" class="text-cyan-400"></i> Precios del Sitio
                </h3>
                <div class="space-y-4">
                    <div class="bg-slate-900 p-4 rounded-xl">
                        <label class="text-xs text-slate-500 uppercase">Inversión Inicial</label>
                        <div id="precio-inicial" class="text-2xl font-bold text-cyan-400 editable-field" contenteditable="true">$50.000</div>
                    </div>
                    <div class="bg-slate-900 p-4 rounded-xl">
                        <label class="text-xs text-slate-500 uppercase">Renovación Anual</label>
                        <div id="precio-renovacion" class="text-2xl font-bold text-emerald-400 editable-field" contenteditable="true">$30.000</div>
                    </div>
                </div>
            </div>

            <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i data-lucide="image" class="text-cyan-400"></i> Logo Institucional
                </h3>
                
                <input type="file" id="logo-input" accept="image/*" class="hidden">
                
                <div id="logo-dropzone" class="upload-zone border-2 border-dashed border-slate-600 rounded-xl p-6 text-center cursor-pointer h-48 flex flex-col items-center justify-center relative overflow-hidden group">
                    
                    <div id="logo-placeholder" class="pointer-events-none">
                        <i data-lucide="upload-cloud" class="w-10 h-10 text-slate-500 mx-auto mb-2"></i>
                        <p class="text-xs text-slate-400">Click para subir logo</p>
                    </div>

                    <img id="logo-preview" class="absolute inset-0 w-full h-full object-contain bg-slate-900 hidden p-4" />
                    
                    <div class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                        <span class="text-xs font-bold text-white">Cambiar Logo</span>
                    </div>
                </div>
                <p class="text-[10px] text-slate-500 mt-2 text-center">Se actualizará automáticamente en el Index</p>
            </div>

            <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700 col-span-1 lg:col-span-2">
                <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i data-lucide="credit-card" class="text-cyan-400"></i> Carnet Demo
                </h3>
                <div class="bg-white text-slate-900 p-4 rounded-xl max-w-md mx-auto">
                    <div class="flex gap-4">
                        <div class="w-20 h-20 bg-slate-300 rounded-lg overflow-hidden">
                             <img id="profesional-foto" class="w-full h-full object-cover hidden">
                             <div id="profesional-placeholder" class="w-full h-full flex items-center justify-center text-slate-500 text-xs">Sin Foto</div>
                        </div>
                        <div>
                            <div id="card-nombre" class="font-black uppercase text-lg editable-field" contenteditable="true">PABLO VERDICCHIO</div>
                            <div class="text-xs font-bold text-slate-600 mt-1">MATRÍCULA: <span id="card-matricula" class="text-red-600 editable-field" contenteditable="true">824374</span></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <div id="toast" class="toast">✅ Cambios Guardados</div>

    <script>
        // === LÓGICA DE PANEL "NIVEL DIOS" ===
        
        const logoInput = document.getElementById('logo-input');
        const logoDropzone = document.getElementById('logo-dropzone');
        const logoPreview = document.getElementById('logo-preview');
        const logoPlaceholder = document.getElementById('logo-placeholder');
        const toast = document.getElementById('toast');

        // 1. INICIALIZAR DATOS AL CARGAR
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            cargarDatos();
        });

        function cargarDatos() {
            // Cargar Textos
            const editableIds = ['precio-inicial', 'precio-renovacion', 'card-nombre', 'card-matricula'];
            editableIds.forEach(id => {
                const val = localStorage.getItem('remaep_' + id);
                if(val) document.getElementById(id).textContent = val;
            });

            // Cargar Logo Institucional
            const savedLogo = localStorage.getItem('remaep_logo_institutional');
            if (savedLogo) {
                mostrarPreviewLogo(savedLogo);
            }
        }

        // 2. MANEJO DE LOGO (Lógica que faltaba)
        logoDropzone.addEventListener('click', () => logoInput.click());

        logoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Validación básica
            if (file.size > 2 * 1024 * 1024) { // 2MB
                alert('El logo es muy pesado. Máximo 2MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const base64String = event.target.result;
                
                // Guardar inmediatamente
                localStorage.setItem('remaep_logo_institutional', base64String);
                
                // Actualizar UI
                mostrarPreviewLogo(base64String);
                mostrarToast('Logo actualizado');
                
                // Notificar al Index (si está abierto)
                notificarCambios();
            };
            reader.readAsDataURL(file);
        });

        function mostrarPreviewLogo(src) {
            logoPreview.src = src;
            logoPreview.classList.remove('hidden');
            logoPlaceholder.classList.add('hidden');
        }

        // 3. GUARDADO GENERAL DE TEXTOS
        window.guardarCambios = function() {
            // Guardar todos los campos con clase .editable-field
            document.querySelectorAll('.editable-field').forEach(el => {
                localStorage.setItem('remaep_' + el.id, el.innerText.trim());
            });

            mostrarToast('Datos sincronizados');
            notificarCambios();
        };

        // 4. SISTEMA DE NOTIFICACIÓN
        function notificarCambios() {
            // Disparar evento de storage para otras pestañas
            // (El evento 'storage' se dispara automáticamente en otras pestañas al usar setItem, 
            // pero esto es un refuerzo para la misma ventana si fuera necesario)
            window.dispatchEvent(new CustomEvent('remaep-datos-actualizados'));
        }

        function mostrarToast(msg) {
            toast.textContent = "✅ " + msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
